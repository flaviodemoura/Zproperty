\section{A Formalization of the Z property}


\begin{coqdoccode}
\end{coqdoccode}
In this section, we present a formalization of the Z property in the context of ARS, which are sets with a binary relation. A binary relation is a predicate over a type \coqdocvar{A}: 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{Rel} (\coqdocvar{A}:\coqdockw{Type}) := \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A} \ensuremath{\rightarrow} \coqdockw{Prop}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
If $(A,R)$, is an ARS and $a,b\in A$ then we write $a\to_R b$ (or $R\ a\ b$ in the Coq syntax below) to denote that $(a,b)\in R$, and in this case, we say that $a$ $R$-reduces to $b$ in one step. The transitive closure of $\to_R$, written $\to^+_R$, is defined as usual by the following inference rules:


    $\begin{mathpar}
     \inferrule*[Right={($singl$)}]{a \to_R b}{a \to^+_R b} \and\and
     \inferrule*[Right={($transit$)}]{a \to_R b \and b \to^+_R c}{a \to^+_R c}
     \end{mathpar}$


 This definition corresponds to the following Coq code, where $\to_R$ (resp. $\to^+_R$) corresponds to \coqdocvar{R} (resp. \coqdocvar{trans} \coqdocvar{R}):$\newline$ 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Inductive} \coqdocvar{trans} \{\coqdocvar{A}\} (\coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}) : \coqdocvar{Rel} \coqdocvar{A} :=\coqdoceol
\coqdocnoindent
\ensuremath{|} \coqdocvar{singl}: \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b},  \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} \coqdocvar{trans} \coqdocvar{R} \coqdocvar{a} \coqdocvar{b}\coqdoceol
\coqdocnoindent
\ensuremath{|} \coqdocvar{transit}: \coqdockw{\ensuremath{\forall}} \coqdocvar{b} \coqdocvar{a} \coqdocvar{c},  \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} \coqdocvar{trans} \coqdocvar{R} \coqdocvar{b} \coqdocvar{c} \ensuremath{\rightarrow} \coqdocvar{trans} \coqdocvar{R} \coqdocvar{a} \coqdocvar{c}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
The reflexive transitive closure of $\to_R$, written $\tto_R$, is defined by:


    $\begin{mathpar}
     \inferrule*[Right={($refl$)}]{a \to_R b}{a \tto_R b} \and\and
     \inferrule*[Right={($rtrans$)}]{a \to_R b \and b \tto_R c}{a \tto_R c}
    \end{mathpar}$


 This definition corresponds to the following Coq code, where $\tto_R$ is written as \coqdocvar{refltrans} \coqdocvar{R}: 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Inductive} \coqdocvar{refltrans} \{\coqdocvar{A}:\coqdockw{Type}\} (\coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}) : \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A} \ensuremath{\rightarrow} \coqdockw{Prop} :=\coqdoceol
\coqdocnoindent
\ensuremath{|} \coqdocvar{refl}: \coqdockw{\ensuremath{\forall}} \coqdocvar{a}, \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{a} \coqdocvar{a}\coqdoceol
\coqdocnoindent
\ensuremath{|} \coqdocvar{rtrans}: \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b} \coqdocvar{c}, \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{b} \coqdocvar{c} \ensuremath{\rightarrow} \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{a} \coqdocvar{c}.\coqdoceol
\end{coqdoccode}
The reflexive transitive closure of a relation is used to define
    the notion of confluence: no matter how the reduction is done, the
    result will always be the same. In other words, every divergence
    is joinable as stated by the following diagram:


    $\centerline{\xymatrix{ & a \ar@{->>}[dl] \ar@{->>}[dr] & \\ b
    \ar@{.>>}[dr] & & c \ar@{.>>}[dl] \\ & d & }}$


Formally, this means that if an expression $a$ can be reduced in two
different ways to $b$ and $c$, then there exists an expression $d$
such that both $b$ and $c$ reduce to $d$. The existential
quantification is expressed by the dotted lines in the diagram. This
notion is defined in the Coq system as follows: 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{Confl} \{\coqdocvar{A}:\coqdockw{Type}\} (\coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}) := \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b} \coqdocvar{c}, (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{a} \coqdocvar{c} \ensuremath{\rightarrow} (\coqdoctac{\ensuremath{\exists}} \coqdocvar{d}, (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{b} \coqdocvar{d} \ensuremath{\land} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{c} \coqdocvar{d}).\coqdoceol
\coqdocemptyline
\end{coqdoccode}
In $\cite{dehornoy2008z}$, V. van Oostrom gives a sufficient condition
for an ARS to be confluent. This condition is based on the $\textit{Z
  Property}$ that is defined as follows:


$\begin{definition} \text{Let } (A,\to_R) \text{ be an ARS. A mapping } f:A \to A 
  \text{ satisfies the Z property for} \to_R, \text{ if } a \to_R b \text{ implies }
  b \tto_R f a  \tto_R f b, \text{ for any } a, b \in A. 
\end{definition}$


The name of the property comes from the following diagrammatic
representation of this definition:


$\xymatrix{ a \ar[r]_R & b \ar@{.>>}[dl]^R\\ f a \ar@{.>>}[r]_R & f
    b \\ }$


If a function \coqdocvar{f} satisfies the Z property for $\to_R$ then
we say that \coqdocvar{f} is Z for $\to_R$, and the corresponding Coq
definition is given by the following predicate: 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{f\_is\_Z} \{\coqdocvar{A}:\coqdockw{Type}\} (\coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{f}: \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}) := \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} ((\coqdocvar{refltrans} \coqdocvar{R})  \coqdocvar{b} (\coqdocvar{f} \coqdocvar{a}) \ensuremath{\land} (\coqdocvar{refltrans} \coqdocvar{R}) (\coqdocvar{f} \coqdocvar{a}) (\coqdocvar{f} \coqdocvar{b})).\coqdoceol
\coqdocemptyline
\end{coqdoccode}
Alternatively, an ARS $(A,\to_R)$ satisfies the Z property if there
exists a mapping $f:A \to A$ such that $f$ is Z for $\to_R$: 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{Z\_prop} \{\coqdocvar{A}:\coqdockw{Type}\} (\coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}) := \coqdoctac{\ensuremath{\exists}} \coqdocvar{f}:\coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}, \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} ((\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{b} (\coqdocvar{f} \coqdocvar{a}) \ensuremath{\land} (\coqdocvar{refltrans} \coqdocvar{R}) (\coqdocvar{f} \coqdocvar{a}) (\coqdocvar{f} \coqdocvar{b})).\coqdoceol
\coqdocemptyline
\end{coqdoccode}
The first contribution of this work is a constructive proof of the fact that the Z property implies confluence. Our proof uses nested induction, and hence it differs from the one in $\cite{kesnerTheoryExplicitSubstitutions2009}$ (that follows $\cite{dehornoy2008z}$) and the one in $\cite{felgenhauerProperty2016}$ in the sense that it does not rely on the analyses of whether a term is in normal form or not, avoiding the necessity of the law of the excluded middle. As a result, we have an elegant inductive proof of the fact that if an ARS satisfies the Z property then it is confluent. 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Theorem} \coqdocvar{Z\_prop\_implies\_Confl} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} \coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}, \coqdocvar{Z\_prop} \coqdocvar{R} \ensuremath{\rightarrow} \coqdocvar{Confl} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{HZ\_prop}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{Z\_prop}, \coqdocvar{Confl} \coqdoctac{in} *.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{c} \coqdocvar{Hrefl1} \coqdocvar{Hrefl2}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{HZ\_prop} \coqdockw{as} [\coqdocvar{g} \coqdocvar{HZ\_prop}].\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{generalize} \coqdoctac{dependent} \coqdocvar{c}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{induction} \coqdocvar{Hrefl1}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intros} \coqdocvar{c} \coqdocvar{Hrefl2}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{c}; \coqdoctac{split}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intros} \coqdocvar{c0} \coqdocvar{Hrefl2}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{generalize} \coqdoctac{dependent} \coqdocvar{c}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{induction} \coqdocvar{Hrefl2}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdocvar{admit}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{intros} \coqdocvar{c'} \coqdocvar{H2} \coqdocvar{IH1}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{generalize} \coqdoctac{dependent} \coqdocvar{b}.\coqdoceol
\coqdocemptyline
\coqdocindent{2.00em}
\coqdoctac{assert} (\coqdocvar{Hbga}: \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{b} (\coqdocvar{g} \coqdocvar{a})).\coqdoceol
\coqdocindent{2.00em}
\{ \coqdoctac{apply} \coqdocvar{HZ\_prop}; \coqdoctac{assumption}. \}\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{assert} (\coqdocvar{Haga}: \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{a} (\coqdocvar{g} \coqdocvar{a})).\coqdoceol
\coqdocindent{2.00em}
\{ \coqdoctac{apply} \coqdocvar{rtrans} \coqdockw{with} \coqdocvar{b}; \coqdoctac{assumption}. \}\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{clear} \coqdocvar{H}. \coqdoctac{generalize} \coqdoctac{dependent} \coqdocvar{b}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{induction} \coqdocvar{Hrefl2}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{intros} \coqdocvar{b} \coqdocvar{Hrefl1} \coqdocvar{IHHrefl1} \coqdocvar{Hbga}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{assert} (\coqdocvar{IHHrefl1\_ga} := \coqdocvar{IHHrefl1} (\coqdocvar{g} \coqdocvar{a}));\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{IHHrefl1\_ga} \coqdoctac{in} \coqdocvar{Hbga}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{destruct} \coqdocvar{Hbga}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{x}; \coqdoctac{split}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{g} \coqdocvar{a}); [\coqdoctac{assumption} \ensuremath{|} \coqdoctac{apply} \coqdocvar{H}].\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{intros} \coqdocvar{b0} \coqdocvar{Hrefl1} \coqdocvar{IHHrefl1} \coqdocvar{Hb0ga}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{apply} \coqdocvar{IHHrefl2} \coqdockw{with} \coqdocvar{b0}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{g} \coqdocvar{a}); \coqdoctac{apply} \coqdocvar{HZ\_prop}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{g} \coqdocvar{a}); [ \coqdoctac{assumption} \ensuremath{|} \coqdoctac{apply} \coqdocvar{HZ\_prop}; \coqdoctac{assumption}].\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{SemiConfl} \{\coqdocvar{A}:\coqdockw{Type}\} (\coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}) := \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b} \coqdocvar{c}, \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{a} \coqdocvar{c} \ensuremath{\rightarrow} (\coqdoctac{\ensuremath{\exists}} \coqdocvar{d}, (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{b} \coqdocvar{d} \ensuremath{\land} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{c} \coqdocvar{d}).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Theorem} \coqdocvar{Z\_prop\_implies\_SemiConfl} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} \coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}, \coqdocvar{Z\_prop} \coqdocvar{R} \ensuremath{\rightarrow} \coqdocvar{SemiConfl} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{HZ\_prop}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{Z\_prop} \coqdoctac{in} \coqdocvar{HZ\_prop}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{SemiConfl}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{HZ\_prop}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{c} \coqdocvar{Hrefl} \coqdocvar{Hrefl'}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{assert} (\coqdocvar{Haxa}: \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{a} (\coqdocvar{x} \coqdocvar{a})).\coqdoceol
\coqdocindent{1.00em}
\{ \coqdoctac{apply} \coqdocvar{rtrans} \coqdockw{with} \coqdocvar{b}. - \coqdoctac{assumption}. - \coqdoctac{apply} \coqdocvar{H}. \coqdoctac{assumption}. \}\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{apply} \coqdocvar{H} \coqdoctac{in} \coqdocvar{Hrefl}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{Hrefl}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{clear} \coqdocvar{H1}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{generalize} \coqdoctac{dependent} \coqdocvar{b}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{induction} \coqdocvar{Hrefl'}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intros}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{x} \coqdocvar{a}).\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{split}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intros}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{destruct} \coqdocvar{IHHrefl'} \coqdockw{with} \coqdocvar{b0}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{x} \coqdocvar{a}); \coqdoctac{apply} \coqdocvar{H}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{x} \coqdocvar{b}).\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{x} \coqdocvar{a}).\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{assumption}.\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{apply} \coqdocvar{H}.\coqdoceol
\coqdocindent{5.50em}
\coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{\ensuremath{\exists}} \coqdocvar{x0}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Theorem} \coqdocvar{Semi\_equiv\_Confl} \{\coqdocvar{A}: \coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} \coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}, \coqdocvar{Confl} \coqdocvar{R} \ensuremath{\leftrightarrow} \coqdocvar{SemiConfl} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{Confl}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{SemiConfl}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intro} \coqdocvar{R}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{split}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intros}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{apply} \coqdocvar{H} \coqdockw{with} \coqdocvar{a}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{rtrans} \coqdockw{with} \coqdocvar{b}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intros}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{generalize} \coqdoctac{dependent} \coqdocvar{c}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{induction} \coqdocvar{H0}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{intros}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{c}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{split}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{intros}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{specialize} (\coqdocvar{H} \coqdocvar{a}).\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{specialize} (\coqdocvar{H} \coqdocvar{b}).\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{specialize} (\coqdocvar{H} \coqdocvar{c0}).\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{apply} \coqdocvar{H} \coqdoctac{in} \coqdocvar{H0}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{destruct} \coqdocvar{H0}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{destruct} \coqdocvar{H0}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{IHrefltrans} \coqdoctac{in} \coqdocvar{H0}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{destruct} \coqdocvar{H0}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{destruct} \coqdocvar{H0}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{x0}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{split}.\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{assumption}.\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} \coqdocvar{x}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Corollary} \coqdocvar{Zprop\_implies\_Confl\_via\_SemiConfl} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} \coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}, \coqdocvar{Z\_prop} \coqdocvar{R} \ensuremath{\rightarrow} \coqdocvar{Confl} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}. \coqdoctac{intros} \coqdocvar{R} \coqdocvar{HZ\_prop}. \coqdoctac{apply} \coqdocvar{Semi\_equiv\_Confl}. \coqdoctac{generalize} \coqdoctac{dependent} \coqdocvar{HZ\_prop}.\coqdoceol
\coqdocindent{3.50em}
\coqdoctac{apply} \coqdocvar{Z\_prop\_implies\_SemiConfl}. \coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\section{An extension of the Z property: Compositional Z}


\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{f\_is\_weak\_Z} \{\coqdocvar{A}\} (\coqdocvar{R} \coqdocvar{R'}: \coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{f}: \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}) := \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} ((\coqdocvar{refltrans} \coqdocvar{R'}) \coqdocvar{b} (\coqdocvar{f} \coqdocvar{a}) \ensuremath{\land} (\coqdocvar{refltrans} \coqdocvar{R'}) (\coqdocvar{f} \coqdocvar{a}) (\coqdocvar{f} \coqdocvar{b})).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{comp} \{\coqdocvar{A}\} (\coqdocvar{f1} \coqdocvar{f2}: \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}) := \coqdockw{fun} \coqdocvar{x}:\coqdocvar{A} \ensuremath{\Rightarrow} \coqdocvar{f1} (\coqdocvar{f2} \coqdocvar{x}).\coqdoceol
\coqdocnoindent
\coqdockw{Notation} "f1 \# f2" := (\coqdocvar{comp} \coqdocvar{f1} \coqdocvar{f2}) (\coqdoctac{at} \coqdockw{level} 40).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Inductive} \coqdocvar{union} \{\coqdocvar{A}\} (\coqdocvar{red1} \coqdocvar{red2}: \coqdocvar{Rel} \coqdocvar{A}) : \coqdocvar{Rel} \coqdocvar{A} :=\coqdoceol
\coqdocnoindent
\ensuremath{|} \coqdocvar{union\_left}: \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{red1} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} \coqdocvar{union} \coqdocvar{red1} \coqdocvar{red2} \coqdocvar{a} \coqdocvar{b}\coqdoceol
\coqdocnoindent
\ensuremath{|} \coqdocvar{union\_right}: \coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{red2} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} \coqdocvar{union} \coqdocvar{red1} \coqdocvar{red2} \coqdocvar{a} \coqdocvar{b}.\coqdoceol
\coqdocnoindent
\coqdockw{Notation} "R1 !\_! R2" := (\coqdocvar{union} \coqdocvar{R1} \coqdocvar{R2}) (\coqdoctac{at} \coqdockw{level} 40).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{union\_or} \{\coqdocvar{A}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{r1} \coqdocvar{r2}: \coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{a} \coqdocvar{b}: \coqdocvar{A}), (\coqdocvar{r1} !\coqdocvar{\_}! \coqdocvar{r2}) \coqdocvar{a} \coqdocvar{b} \ensuremath{\leftrightarrow} (\coqdocvar{r1} \coqdocvar{a} \coqdocvar{b}) \ensuremath{\lor} (\coqdocvar{r2} \coqdocvar{a} \coqdocvar{b}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{r1} \coqdocvar{r2} \coqdocvar{a} \coqdocvar{b}; \coqdoctac{split}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intro} \coqdocvar{Hunion}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{inversion} \coqdocvar{Hunion}; \coqdoctac{subst}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{intro} \coqdocvar{Hunion}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{inversion} \coqdocvar{Hunion}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{union\_left}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{union\_right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{Setoid}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{ZArith}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{equiv\_refltrans} \{\coqdocvar{A}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} \coqdocvar{R1} \coqdocvar{R2}: \coqdocvar{Rel} \coqdocvar{A}), (\coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y}, \coqdocvar{R} \coqdocvar{x} \coqdocvar{y} \ensuremath{\leftrightarrow} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y}) \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y}, \coqdocvar{refltrans} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y} \ensuremath{\rightarrow} \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{x} \coqdocvar{y}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{induction} \coqdocvar{H0}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{rtrans} \coqdockw{with} \coqdocvar{b}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{H}. \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{Z\_comp} \{\coqdocvar{A}:\coqdockw{Type}\} (\coqdocvar{R} :\coqdocvar{Rel} \coqdocvar{A}) := \coqdoctac{\ensuremath{\exists}} (\coqdocvar{R1} \coqdocvar{R2}: \coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{f1} \coqdocvar{f2}: \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}), (\coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y}, \coqdocvar{R} \coqdocvar{x} \coqdocvar{y} \ensuremath{\leftrightarrow} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y}) \ensuremath{\land} \coqdocvar{f\_is\_Z} \coqdocvar{R1} \coqdocvar{f1} \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{R1} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) ((\coqdocvar{f2} \# \coqdocvar{f1}) \coqdocvar{a}) ((\coqdocvar{f2} \# \coqdocvar{f1}) \coqdocvar{b})) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{b} = \coqdocvar{f1} \coqdocvar{a} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{b} (\coqdocvar{f2} \coqdocvar{b})) \ensuremath{\land} (\coqdocvar{f\_is\_weak\_Z} \coqdocvar{R2} \coqdocvar{R} (\coqdocvar{f2} \# \coqdocvar{f1})).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{refltrans\_union} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} \coqdocvar{R'} :\coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{a} \coqdocvar{b}: \coqdocvar{A}), \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} \coqdocvar{refltrans} (\coqdocvar{R} !\coqdocvar{\_}! \coqdocvar{R'}) \coqdocvar{a} \coqdocvar{b}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{R'} \coqdocvar{a} \coqdocvar{b} \coqdocvar{Hrefl}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{induction} \coqdocvar{Hrefl}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{rtrans} \coqdockw{with} \coqdocvar{b}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{union\_left}. \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{Setoid}.\coqdoceol
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{refltrans\_union\_equiv} \{\coqdocvar{A}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} \coqdocvar{R1} \coqdocvar{R2} : \coqdocvar{Rel} \coqdocvar{A}), (\coqdockw{\ensuremath{\forall}} (\coqdocvar{x} \coqdocvar{y} : \coqdocvar{A}), (\coqdocvar{R} \coqdocvar{x} \coqdocvar{y} \ensuremath{\leftrightarrow} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y})) \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} (\coqdocvar{x} \coqdocvar{y}: \coqdocvar{A}), \coqdocvar{refltrans} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y} \ensuremath{\rightarrow} \coqdocvar{refltrans} \coqdocvar{R} \coqdocvar{x} \coqdocvar{y}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{induction} \coqdocvar{H0}.\coqdoceol
\coqdocindent{1.00em}
+ \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{1.00em}
+ \coqdoctac{apply} \coqdocvar{rtrans} \coqdockw{with} \coqdocvar{b}.\coqdoceol
\coqdocindent{2.00em}
- \coqdoctac{apply} \coqdocvar{H}. \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
- \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Theorem} \coqdocvar{Z\_comp\_implies\_Z\_prop} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} :\coqdocvar{Rel} \coqdocvar{A}), \coqdocvar{Z\_comp} \coqdocvar{R} \ensuremath{\rightarrow} \coqdocvar{Z\_prop} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{H}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{Z\_prop}. \coqdoctac{unfold} \coqdocvar{Z\_comp} \coqdoctac{in} \coqdocvar{H}. \coqdoctac{destruct} \coqdocvar{H} \coqdockw{as}\coqdoceol
\coqdocindent{1.00em}
[ \coqdocvar{R1} [ \coqdocvar{R2} [\coqdocvar{f1} [\coqdocvar{f2} [\coqdocvar{Hunion} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{H3} \coqdocvar{H4}]]]]]]]].\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{f2} \# \coqdocvar{f1}).\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{HR}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{apply} \coqdocvar{Hunion} \coqdoctac{in} \coqdocvar{HR}. \coqdoctac{inversion} \coqdocvar{HR}; \coqdoctac{subst}. \coqdoctac{clear} \coqdocvar{HR}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{split}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{f1} \coqdocvar{a}).\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{destruct} \coqdocvar{H} \coqdockw{as} [\coqdocvar{Hb} \coqdocvar{Hf}].\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} (\coqdocvar{refltrans\_union} \coqdocvar{R1} \coqdocvar{R2}) \coqdoctac{in} \coqdocvar{Hb}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{refltrans\_union\_equiv} \coqdockw{with} \coqdocvar{R1} \coqdocvar{R2}.\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{apply} \coqdocvar{Hunion}.\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{apply} \coqdocvar{Hb}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H3} \coqdockw{with} \coqdocvar{a}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{H2}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{H4}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
Now we can use the proofs of the theorems \coqdocvar{Z\_comp\_implies\_Z\_prop}
and \coqdocvar{Z\_prop\_implies\_Confl} to conclude that compositional Z is a
sufficient condition for confluence. 
\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Corollary} \coqdocvar{Z\_comp\_is\_Confl} \{\coqdocvar{A}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R}: \coqdocvar{Rel} \coqdocvar{A}), \coqdocvar{Z\_comp} \coqdocvar{R} \ensuremath{\rightarrow} \coqdocvar{Confl} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{H}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{apply} \coqdocvar{Z\_comp\_implies\_Z\_prop} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{apply} \coqdocvar{Z\_prop\_implies\_Confl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Theorem} \coqdocvar{Z\_comp\_thm} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} :\coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{R1} \coqdocvar{R2}: \coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{f1} \coqdocvar{f2}: \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}), (\coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y}, \coqdocvar{R} \coqdocvar{x} \coqdocvar{y} \ensuremath{\leftrightarrow} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y}) \ensuremath{\land} \coqdocvar{f\_is\_Z} \coqdocvar{R1} \coqdocvar{f1} \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{R1} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) ((\coqdocvar{f2} \# \coqdocvar{f1}) \coqdocvar{a}) ((\coqdocvar{f2} \# \coqdocvar{f1}) \coqdocvar{b})) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{b} = \coqdocvar{f1} \coqdocvar{a} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{b} (\coqdocvar{f2} \coqdocvar{b})) \ensuremath{\land} (\coqdocvar{f\_is\_weak\_Z} \coqdocvar{R2} \coqdocvar{R} (\coqdocvar{f2} \# \coqdocvar{f1})) \ensuremath{\rightarrow} \coqdocvar{f\_is\_Z} \coqdocvar{R} (\coqdocvar{f2} \# \coqdocvar{f1}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{R1} \coqdocvar{R2} \coqdocvar{f1} \coqdocvar{f2} \coqdocvar{H}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{H} \coqdockw{as} [\coqdocvar{Hunion} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{H3} \coqdocvar{H4}]]]].\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{f\_is\_Z}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{apply} \coqdocvar{Hunion} \coqdoctac{in} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{inversion} \coqdocvar{Hab}; \coqdoctac{subst}. \coqdoctac{clear} \coqdocvar{Hab}; \coqdoctac{split}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{f1} \coqdocvar{a}).\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{assert} (\coqdocvar{Hbf1a}: \coqdocvar{refltrans} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{b} (\coqdocvar{f1} \coqdocvar{a})).\coqdoceol
\coqdocindent{2.00em}
\{ \coqdoctac{apply} \coqdocvar{refltrans\_union}. \coqdoctac{apply} \coqdocvar{H1}; \coqdoctac{assumption}. \}\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{apply} \coqdocvar{equiv\_refltrans} \coqdockw{with} \coqdocvar{R1} \coqdocvar{R2}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{assumption}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{H3} \coqdockw{with} \coqdocvar{a}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{unfold} \coqdocvar{comp}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{H}).\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{destruct} \coqdocvar{H} \coqdockw{as} [\coqdocvar{H} \coqdocvar{Hf1}].\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{clear} \coqdocvar{H}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{apply} \coqdocvar{H2}; \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{H4}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Corollary} \coqdocvar{Z\_comp\_eq\_corol} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} :\coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{R1} \coqdocvar{R2}: \coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{f1} \coqdocvar{f2}: \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}), (\coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y}, \coqdocvar{R} \coqdocvar{x} \coqdocvar{y} \ensuremath{\leftrightarrow} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y}) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{R1} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{f1} \coqdocvar{a}) = (\coqdocvar{f1} \coqdocvar{b})) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a}, (\coqdocvar{refltrans} \coqdocvar{R1}) \coqdocvar{a} (\coqdocvar{f1} \coqdocvar{a})) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{b} \coqdocvar{a}, \coqdocvar{a} = \coqdocvar{f1} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{a} (\coqdocvar{f2} \coqdocvar{a})) \ensuremath{\land} (\coqdocvar{f\_is\_weak\_Z} \coqdocvar{R2} \coqdocvar{R} (\coqdocvar{f2} \# \coqdocvar{f1})) \ensuremath{\rightarrow} \coqdocvar{f\_is\_Z} \coqdocvar{R} (\coqdocvar{f2} \# \coqdocvar{f1}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{R1} \coqdocvar{R2} \coqdocvar{f1} \coqdocvar{f2} \coqdocvar{H}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{H} \coqdockw{as} [\coqdocvar{Hunion} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{H3} \coqdocvar{H4}]]]].\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{pose} \coqdocvar{proof} (\coqdocvar{Z\_comp\_thm} := \coqdocvar{Z\_comp\_thm} \coqdocvar{R} \coqdocvar{R1} \coqdocvar{R2} \coqdocvar{f1} \coqdocvar{f2}).\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{apply} \coqdocvar{Z\_comp\_thm}. \coqdoctac{split}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{split}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{unfold} \coqdocvar{f\_is\_Z}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{Hab}. \coqdoctac{split}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{rewrite} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{H2}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{rewrite} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{split}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{unfold} \coqdocvar{comp}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{rewrite} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{split}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{Z\_comp\_eq} \{\coqdocvar{A}:\coqdockw{Type}\} (\coqdocvar{R} :\coqdocvar{Rel} \coqdocvar{A}) := \coqdoctac{\ensuremath{\exists}} (\coqdocvar{R1} \coqdocvar{R2}: \coqdocvar{Rel} \coqdocvar{A}) (\coqdocvar{f1} \coqdocvar{f2}: \coqdocvar{A} \ensuremath{\rightarrow} \coqdocvar{A}), (\coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y}, \coqdocvar{R} \coqdocvar{x} \coqdocvar{y} \ensuremath{\leftrightarrow} (\coqdocvar{R1} !\coqdocvar{\_}! \coqdocvar{R2}) \coqdocvar{x} \coqdocvar{y}) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a} \coqdocvar{b}, \coqdocvar{R1} \coqdocvar{a} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{f1} \coqdocvar{a}) = (\coqdocvar{f1} \coqdocvar{b})) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{a}, (\coqdocvar{refltrans} \coqdocvar{R1}) \coqdocvar{a} (\coqdocvar{f1} \coqdocvar{a})) \ensuremath{\land} (\coqdockw{\ensuremath{\forall}} \coqdocvar{b} \coqdocvar{a}, \coqdocvar{a} = \coqdocvar{f1} \coqdocvar{b} \ensuremath{\rightarrow} (\coqdocvar{refltrans} \coqdocvar{R}) \coqdocvar{a} (\coqdocvar{f2} \coqdocvar{a})) \ensuremath{\land} (\coqdocvar{f\_is\_weak\_Z} \coqdocvar{R2} \coqdocvar{R} (\coqdocvar{f2} \# \coqdocvar{f1})).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{Z\_comp\_eq\_implies\_Z\_comp} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} : \coqdocvar{Rel} \coqdocvar{A}), \coqdocvar{Z\_comp\_eq} \coqdocvar{R} \ensuremath{\rightarrow} \coqdocvar{Z\_comp} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{Heq}. \coqdoctac{unfold} \coqdocvar{Z\_comp\_eq} \coqdoctac{in} \coqdocvar{Heq}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{Heq} \coqdockw{as} [\coqdocvar{R1} [\coqdocvar{R2} [\coqdocvar{f1} [\coqdocvar{f2} [\coqdocvar{Hunion} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{H3} \coqdocvar{H4}]]]]]]]].\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{Z\_comp}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{R1}, \coqdocvar{R2}, \coqdocvar{f1}, \coqdocvar{f2}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{split}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{split}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{unfold} \coqdocvar{f\_is\_Z}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{H}; \coqdoctac{split}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}. \coqdoctac{rewrite} \coqdocvar{H}. \coqdoctac{apply} \coqdocvar{H2}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}. \coqdoctac{rewrite} \coqdocvar{H}. \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{split}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{H}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{unfold} \coqdocvar{comp}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{rewrite} \coqdocvar{H}.\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{split}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{Z\_comp\_eq\_implies\_Z\_prop} \{\coqdocvar{A}:\coqdockw{Type}\}: \coqdockw{\ensuremath{\forall}} (\coqdocvar{R} : \coqdocvar{Rel} \coqdocvar{A}), \coqdocvar{Z\_comp\_eq} \coqdocvar{R} \ensuremath{\rightarrow} \coqdocvar{Z\_prop} \coqdocvar{R}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{R} \coqdocvar{Heq}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{Z\_comp\_eq} \coqdoctac{in} \coqdocvar{Heq}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{Heq} \coqdockw{as} [\coqdocvar{R1} [\coqdocvar{R2} [\coqdocvar{f1} [\coqdocvar{f2} [\coqdocvar{Hunion} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{H3} \coqdocvar{H4}]]]]]]]].\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{unfold} \coqdocvar{Z\_prop}. \coqdoctac{\ensuremath{\exists}} (\coqdocvar{f2} \# \coqdocvar{f1}).\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{b} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{split}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{Hunion} \coqdoctac{in} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{inversion} \coqdocvar{Hab}; \coqdoctac{subst}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{unfold} \coqdocvar{comp}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}. \coqdoctac{rewrite} \coqdocvar{H}.\coqdoceol
\coqdocindent{3.00em}
\coqdoctac{apply} \coqdocvar{refltrans\_composition} \coqdockw{with} (\coqdocvar{f1} \coqdocvar{b}).\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{assert} (\coqdocvar{H5}: \coqdocvar{refltrans} \coqdocvar{R1} \coqdocvar{b} (\coqdocvar{f1} \coqdocvar{b})).\coqdoceol
\coqdocindent{4.00em}
\{\coqdoceol
\coqdocindent{5.00em}
\coqdoctac{apply} \coqdocvar{H2}.\coqdoceol
\coqdocindent{4.00em}
\}\coqdoceol
\coqdocindent{4.00em}
\coqdoctac{apply} \coqdocvar{refltrans\_union\_equiv} \coqdockw{with} \coqdocvar{R1} \coqdocvar{R2}.\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{assumption}.\coqdoceol
\coqdocindent{4.00em}
** \coqdoctac{apply} \coqdocvar{refltrans\_union}. \coqdoctac{assumption}.\coqdoceol
\coqdocindent{3.00em}
\ensuremath{\times} \coqdoctac{apply} \coqdocvar{H3} \coqdockw{with} \coqdocvar{b}. \coqdoctac{reflexivity}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{H4}. \coqdoctac{assumption}.\coqdoceol
\coqdocindent{1.00em}
- \coqdoctac{apply} \coqdocvar{Hunion} \coqdoctac{in} \coqdocvar{Hab}.\coqdoceol
\coqdocindent{2.00em}
\coqdoctac{inversion} \coqdocvar{Hab}; \coqdoctac{subst}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{unfold} \coqdocvar{comp}. \coqdoctac{apply} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}. \coqdoctac{rewrite} \coqdocvar{H}. \coqdoctac{apply} \coqdocvar{refl}.\coqdoceol
\coqdocindent{2.00em}
+ \coqdoctac{apply} \coqdocvar{H4}. \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\end{coqdoccode}
